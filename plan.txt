这是一个非常棒的功能完善请求！为了实现一个体验流畅、功能完整的点餐系统（类似 GrabFood 或美团外卖），我们需要将原本硬编码的 XML 布局改为动态的 `RecyclerView` 列表，并实现“添加”按钮与“加减数量”控件的动态切换。

以下是详细的实施方案，涵盖了 UI 布局、适配器逻辑、ViewModel 状态管理以及数据库保存功能。

### 1\. 准备图片资源

根据您提供的 HTML 样例中的 6 个菜品，以及您提到的 drawable 文件夹中的图片，我们将假设您已经有了以下图片资源（如果没有，请将您的 PNG图片重命名为以下名称并放入 `res/drawable` 文件夹）：

1.  **Beef Noodle Soup**: `food_beef_noodle`
2.  **Fried Noodles**: `food_fried_noodles`
3.  **Chicken Fried Rice**: `food_chicken_rice`
4.  **Combo Rice Set**: `food_combo_rice`
5.  **Bubble Tea**: `food_bubble_tea`
6.  **Iced Lemon Tea**: `food_lemon_tea`

### 2\. 单个菜品的布局文件 (`item_food_menu.xml`)

我们需要新建一个布局文件来定义每一行菜品的样子。这里最关键的是**右下角的按钮区域**：默认显示 "Add"，当数量大于 0 时，显示 "减号 数量 加号"。

```xml
<?xml version="1.0" encoding="utf-8"?>
<com.google.android.material.card.MaterialCardView xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:layout_marginHorizontal="16dp"
    android:layout_marginBottom="12dp"
    app:cardCornerRadius="12dp"
    app:cardElevation="2dp"
    app:cardBackgroundColor="@color/surface">

    <androidx.constraintlayout.widget.ConstraintLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:padding="12dp">

        <com.google.android.material.imageview.ShapeableImageView
            android:id="@+id/iv_food_image"
            android:layout_width="80dp"
            android:layout_height="80dp"
            android:scaleType="centerCrop"
            app:shapeAppearanceOverlay="@style/ShapeAppearance.Material3.Corner.Medium"
            app:layout_constraintStart_toStartOf="parent"
            app:layout_constraintTop_toTopOf="parent"
            app:layout_constraintBottom_toBottomOf="parent"
            tools:srcCompat="@drawable/food_beef_noodle" />

        <TextView
            android:id="@+id/tv_food_name"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_marginStart="12dp"
            android:layout_marginEnd="8dp"
            android:text="Beef Noodle Soup"
            android:textColor="@color/text_primary"
            android:textSize="16sp"
            android:textStyle="bold"
            app:layout_constraintEnd_toStartOf="@+id/layout_action_area"
            app:layout_constraintStart_toEndOf="@id/iv_food_image"
            app:layout_constraintTop_toTopOf="@id/iv_food_image" />

        <TextView
            android:id="@+id/tv_food_desc"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_marginStart="12dp"
            android:layout_marginTop="4dp"
            android:layout_marginEnd="8dp"
            android:ellipsize="end"
            android:maxLines="2"
            android:text="Traditional beef noodle with rich broth"
            android:textColor="@color/text_secondary"
            android:textSize="12sp"
            app:layout_constraintEnd_toStartOf="@+id/layout_action_area"
            app:layout_constraintStart_toEndOf="@id/iv_food_image"
            app:layout_constraintTop_toBottomOf="@id/tv_food_name" />

        <TextView
            android:id="@+id/tv_food_price"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_marginStart="12dp"
            android:text="RM 12.50"
            android:textColor="#FF6B6B"
            android:textSize="16sp"
            android:textStyle="bold"
            app:layout_constraintBottom_toBottomOf="@id/iv_food_image"
            app:layout_constraintStart_toEndOf="@id/iv_food_image" />

        <FrameLayout
            android:id="@+id/layout_action_area"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            app:layout_constraintBottom_toBottomOf="parent"
            app:layout_constraintEnd_toEndOf="parent"
            app:layout_constraintTop_toTopOf="parent"
            app:layout_constraintVertical_bias="1.0">

            <com.google.android.material.button.MaterialButton
                android:id="@+id/btn_add"
                style="@style/Widget.Material3.Button"
                android:layout_width="80dp"
                android:layout_height="36dp"
                android:padding="0dp"
                android:text="Add"
                android:textSize="12sp"
                app:cornerRadius="18dp"
                app:backgroundTint="#4CAF50" />

            <LinearLayout
                android:id="@+id/layout_qty_control"
                android:layout_width="wrap_content"
                android:layout_height="36dp"
                android:orientation="horizontal"
                android:gravity="center_vertical"
                android:background="@drawable/bg_quantity_control"
                android:visibility="gone"
                tools:visibility="visible">

                <ImageButton
                    android:id="@+id/btn_minus"
                    android:layout_width="32dp"
                    android:layout_height="32dp"
                    android:background="?attr/selectableItemBackgroundBorderless"
                    android:src="@drawable/ic_remove"
                    app:tint="#4CAF50" />

                <TextView
                    android:id="@+id/tv_qty"
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:minWidth="24dp"
                    android:gravity="center"
                    android:text="1"
                    android:textSize="14sp"
                    android:textStyle="bold"
                    android:textColor="@color/text_primary" />

                <ImageButton
                    android:id="@+id/btn_plus"
                    android:layout_width="32dp"
                    android:layout_height="32dp"
                    android:background="?attr/selectableItemBackgroundBorderless"
                    android:src="@drawable/ic_add"
                    app:tint="#4CAF50" />
            </LinearLayout>

        </FrameLayout>

    </androidx.constraintlayout.widget.ConstraintLayout>
</com.google.android.material.card.MaterialCardView>
```

*(注意：如果找不到 `ic_remove` 和 `ic_add`，可以使用系统自带的 `android.R.drawable.ic_input_delete` 或创建简单的矢量图)*

### 3\. 菜单页面布局 (`fragment_restaurant_menu.xml`)

修改为使用 `RecyclerView`，并保留底部的购物车悬浮栏。

```xml
<androidx.coordinatorlayout.widget.CoordinatorLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:background="@color/background">

    <com.google.android.material.appbar.AppBarLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:background="@color/surface">
        
        <androidx.appcompat.widget.Toolbar
            android:id="@+id/toolbar"
            android:layout_width="match_parent"
            android:layout_height="?attr/actionBarSize">
            
            <TextView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="Chinese Restaurant"
                android:textSize="18sp"
                android:textStyle="bold"
                android:layout_gravity="center"
                android:textColor="@color/text_primary"/>
                
        </androidx.appcompat.widget.Toolbar>
    </com.google.android.material.appbar.AppBarLayout>

    <androidx.recyclerview.widget.RecyclerView
        android:id="@+id/rv_menu_items"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:clipToPadding="false"
        android:paddingTop="16dp"
        android:paddingBottom="80dp"
        app:layout_behavior="@string/appbar_scrolling_view_behavior" />

    <LinearLayout
        android:id="@+id/layout_cart_summary"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:layout_gravity="bottom"
        android:background="@color/surface"
        android:elevation="16dp"
        android:orientation="horizontal"
        android:padding="16dp"
        android:visibility="gone">

        <LinearLayout
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_weight="1"
            android:orientation="vertical">

            <TextView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="Total"
                android:textColor="@color/text_secondary"
                android:textSize="12sp" />

            <TextView
                android:id="@+id/tv_total_price"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="RM 0.00"
                android:textColor="@color/text_primary"
                android:textSize="20sp"
                android:textStyle="bold" />
        </LinearLayout>

        <com.google.android.material.button.MaterialButton
            android:id="@+id/btn_view_cart"
            android:layout_width="wrap_content"
            android:layout_height="48dp"
            android:text="View Cart (0)"
            android:backgroundTint="#4CAF50"
            app:cornerRadius="24dp" />
    </LinearLayout>

</androidx.coordinatorlayout.widget.CoordinatorLayout>
```

### 4\. 适配器逻辑 (`FoodMenuAdapter.kt`)

这是实现 "Add" 变 "+ 1 -" 的核心。

```kotlin
package com.nottingham.mynottingham.ui.errand

import android.view.LayoutInflater
import android.view.View
import android.view.ViewGroup
import androidx.recyclerview.widget.RecyclerView
import com.nottingham.mynottingham.data.model.MenuItem
import com.nottingham.mynottingham.databinding.ItemFoodMenuBinding

class FoodMenuAdapter(
    private val items: List<MenuItem>,
    private val cartQuantities: Map<String, Int>, // 传入当前的购物车数量 Map <ItemID, Quantity>
    private val onAddClick: (MenuItem) -> Unit,
    private val onMinusClick: (MenuItem) -> Unit,
    private val onPlusClick: (MenuItem) -> Unit
) : RecyclerView.Adapter<FoodMenuAdapter.FoodViewHolder>() {

    inner class FoodViewHolder(val binding: ItemFoodMenuBinding) : RecyclerView.ViewHolder(binding.root)

    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): FoodViewHolder {
        val binding = ItemFoodMenuBinding.inflate(LayoutInflater.from(parent.context), parent, false)
        return FoodViewHolder(binding)
    }

    override fun onBindViewHolder(holder: FoodViewHolder, position: Int) {
        val item = items[position]
        val qty = cartQuantities[item.id] ?: 0

        with(holder.binding) {
            tvFoodName.text = item.name
            tvFoodDesc.text = item.description
            tvFoodPrice.text = String.format("RM %.2f", item.price)
            
            // 设置图片 (假设您在 data class 中添加了 imageResId)
            // 如果没有, 这里需要根据 item.id 或名称手动设置图片
             ivFoodImage.setImageResource(getImageResId(item.name))

            // 控制按钮状态
            if (qty > 0) {
                btnAdd.visibility = View.GONE
                layoutQtyControl.visibility = View.VISIBLE
                tvQty.text = qty.toString()
            } else {
                btnAdd.visibility = View.VISIBLE
                layoutQtyControl.visibility = View.GONE
            }

            // 点击事件
            btnAdd.setOnClickListener { onAddClick(item) }
            btnPlus.setOnClickListener { onPlusClick(item) }
            btnMinus.setOnClickListener { onMinusClick(item) }
        }
    }

    override fun getItemCount() = items.size
    
    // 简单的图片映射辅助函数
    private fun getImageResId(name: String): Int {
        return when {
            name.contains("Beef") -> com.nottingham.mynottingham.R.drawable.food_beef_noodle
            name.contains("Fried Noodles") -> com.nottingham.mynottingham.R.drawable.food_fried_noodles
            name.contains("Chicken Fried Rice") -> com.nottingham.mynottingham.R.drawable.food_chicken_rice
            name.contains("Combo") -> com.nottingham.mynottingham.R.drawable.food_combo_rice
            name.contains("Bubble") -> com.nottingham.mynottingham.R.drawable.food_bubble_tea
            name.contains("Lemon") -> com.nottingham.mynottingham.R.drawable.food_lemon_tea
            else -> com.nottingham.mynottingham.R.drawable.ic_placeholder // 默认图片
        }
    }
}
```

### 5\. 业务逻辑 (`RestaurantMenuViewModel.kt`)

我们需要更新 ViewModel 以支持精确的加减操作，并保存到数据库。

```kotlin
package com.nottingham.mynottingham.ui.errand

import android.app.Application
import androidx.lifecycle.AndroidViewModel
import androidx.lifecycle.LiveData
import androidx.lifecycle.MutableLiveData
import androidx.lifecycle.viewModelScope
import com.nottingham.mynottingham.data.local.database.AppDatabase
import com.nottingham.mynottingham.data.local.database.entities.ErrandEntity
import com.nottingham.mynottingham.data.model.CartItem
import com.nottingham.mynottingham.data.model.MenuItem
import kotlinx.coroutines.Dispatchers
import kotlinx.coroutines.launch
import java.util.UUID

class RestaurantMenuViewModel(application: Application) : AndroidViewModel(application) {

    private val errandDao = AppDatabase.getInstance(application).errandDao()

    // 6个固定菜品数据
    val menuItems = listOf(
        MenuItem("1", "noodles", "Beef Noodle Soup", "Traditional beef noodle with rich broth", 12.50),
        MenuItem("2", "noodles", "Fried Noodles", "Stir-fried noodles with vegetables", 10.00),
        MenuItem("3", "rice", "Chicken Fried Rice", "Fragrant fried rice with chicken", 11.00),
        MenuItem("4", "rice", "Combo Rice Set", "Rice with 2 meat and 2 veg dishes", 15.00),
        MenuItem("5", "drinks", "Bubble Tea", "Sweet milk tea with pearls", 6.00),
        MenuItem("6", "drinks", "Iced Lemon Tea", "Refreshing lemon tea", 4.50)
    )

    // 购物车状态: Map<ItemId, Count>，用于 UI 快速响应
    private val _cartQuantities = MutableLiveData<Map<String, Int>>(emptyMap())
    val cartQuantities: LiveData<Map<String, Int>> = _cartQuantities

    // 购物车详细信息 (用于计算总价和下单)
    private val _cartItems = MutableLiveData<List<CartItem>>(emptyList())
    
    // 总价和总数
    private val _totalPrice = MutableLiveData(0.0)
    val totalPrice: LiveData<Double> = _totalPrice
    
    private val _totalCount = MutableLiveData(0)
    val totalCount: LiveData<Int> = _totalCount

    fun addItem(item: MenuItem) {
        updateCart(item, 1)
    }

    fun increaseItem(item: MenuItem) {
        updateCart(item, 1)
    }

    fun decreaseItem(item: MenuItem) {
        updateCart(item, -1)
    }

    private fun updateCart(item: MenuItem, change: Int) {
        val currentQtyMap = _cartQuantities.value?.toMutableMap() ?: mutableMapOf()
        val currentCount = currentQtyMap[item.id] ?: 0
        val newCount = currentCount + change

        if (newCount <= 0) {
            currentQtyMap.remove(item.id)
        } else {
            currentQtyMap[item.id] = newCount
        }

        _cartQuantities.value = currentQtyMap
        calculateTotals(currentQtyMap)
    }

    private fun calculateTotals(qtyMap: Map<String, Int>) {
        var total = 0.0
        var count = 0
        val itemsList = mutableListOf<CartItem>()

        qtyMap.forEach { (id, qty) ->
            val menuItem = menuItems.find { it.id == id }
            if (menuItem != null) {
                total += menuItem.price * qty
                count += qty
                itemsList.add(CartItem(menuItem, qty))
            }
        }
        
        // 加上 RM 2.00 运费 (如果有商品)
        if (count > 0) total += 2.00

        _totalPrice.value = total
        _totalCount.value = count
        _cartItems.value = itemsList
    }

    fun placeOrder(userId: String, address: String) {
        val items = _cartItems.value ?: return
        if (items.isEmpty()) return

        viewModelScope.launch(Dispatchers.IO) {
            val sb = StringBuilder()
            sb.append("Order from Chinese Restaurant:\n")
            items.forEach { 
                sb.append("- ${it.menuItem.name} x${it.quantity}\n") 
            }
            sb.append("\nDelivery Fee: RM 2.00")

            val errand = ErrandEntity(
                id = UUID.randomUUID().toString(),
                requesterId = userId,
                title = "Food Delivery: Chinese Restaurant",
                description = sb.toString(),
                type = "Food Delivery",
                priority = "Standard",
                pickupLocation = "Golden Dragon Restaurant",
                deliveryLocation = address,
                fee = _totalPrice.value ?: 0.0,
                status = "pending",
                imageUrl = "android.resource://com.nottingham.mynottingham/drawable/food_beef_noodle", // 示例图片
                createdAt = System.currentTimeMillis(),
                updatedAt = System.currentTimeMillis()
            )
            errandDao.insertErrand(errand)
        }
    }
}
```

### 6\. Fragment 绑定与交互 (`RestaurantMenuFragment.kt`)

最后，将它们整合在一起。

```kotlin
package com.nottingham.mynottingham.ui.errand

import android.app.AlertDialog
import android.os.Bundle
import android.view.LayoutInflater
import android.view.View
import android.view.ViewGroup
import android.widget.Toast
import androidx.fragment.app.Fragment
import androidx.fragment.app.viewModels
import androidx.navigation.fragment.findNavController
import androidx.recyclerview.widget.LinearLayoutManager
import com.nottingham.mynottingham.databinding.FragmentRestaurantMenuBinding

class RestaurantMenuFragment : Fragment() {

    private var _binding: FragmentRestaurantMenuBinding? = null
    private val binding get() = _binding!!
    private val viewModel: RestaurantMenuViewModel by viewModels()
    private lateinit var adapter: FoodMenuAdapter

    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?, savedInstanceState: Bundle?): View {
        _binding = FragmentRestaurantMenuBinding.inflate(inflater, container, false)
        return binding.root
    }

    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
        super.onViewCreated(view, savedInstanceState)

        setupRecyclerView()
        setupObservers()
        
        // 顶部返回按钮
        binding.toolbar.setNavigationOnClickListener { findNavController().navigateUp() }
        
        // 底部 View Cart 按钮
        binding.btnViewCart.setOnClickListener { showCartSummary() }
    }

    private fun setupRecyclerView() {
        // 初始化 Adapter, 传入空 map, 之后通过 observer 更新
        adapter = FoodMenuAdapter(
            items = viewModel.menuItems,
            cartQuantities = emptyMap(),
            onAddClick = { viewModel.addItem(it) },
            onPlusClick = { viewModel.increaseItem(it) },
            onMinusClick = { viewModel.decreaseItem(it) }
        )
        
        binding.rvMenuItems.apply {
            layoutManager = LinearLayoutManager(context)
            adapter = this@RestaurantMenuFragment.adapter
        }
    }

    private fun setupObservers() {
        // 监听购物车数量变化，刷新列表 UI (显示/隐藏加减号)
        viewModel.cartQuantities.observe(viewLifecycleOwner) { quantities ->
            // 重新创建 Adapter 以更新所有行状态 (或者可以在 Adapter 中写 updateData 方法以提高性能)
            adapter = FoodMenuAdapter(
                items = viewModel.menuItems,
                cartQuantities = quantities,
                onAddClick = { viewModel.addItem(it) },
                onPlusClick = { viewModel.increaseItem(it) },
                onMinusClick = { viewModel.decreaseItem(it) }
            )
            binding.rvMenuItems.adapter = adapter
        }

        // 监听总价和总数，控制底部栏显示
        viewModel.totalCount.observe(viewLifecycleOwner) { count ->
            if (count > 0) {
                binding.layoutCartSummary.visibility = View.VISIBLE
                binding.btnViewCart.text = "View Cart ($count)"
            } else {
                binding.layoutCartSummary.visibility = View.GONE
            }
        }

        viewModel.totalPrice.observe(viewLifecycleOwner) { price ->
            binding.tvTotalPrice.text = String.format("RM %.2f", price)
        }
    }

    private fun showCartSummary() {
        val total = viewModel.totalPrice.value ?: 0.0
        
        AlertDialog.Builder(requireContext())
            .setTitle("Checkout")
            .setMessage("Confirm order for RM ${String.format("%.2f", total)}?\n(Includes Delivery Fee)")
            .setPositiveButton("Place Order") { _, _ ->
                // 实际开发中应替换为真实 User ID
                viewModel.placeOrder("user_123", "Dorm Room 305")
                Toast.makeText(context, "Order Placed Successfully!", Toast.LENGTH_SHORT).show()
                findNavController().navigateUp()
            }
            .setNegativeButton("Cancel", null)
            .show()
    }

    override fun onDestroyView() {
        super.onDestroyView()
        _binding = null
    }
}
```

### 总结与完善建议

1.  **图片对应**：请确保您的 `drawable` 文件夹中有上面代码中引用的 6 张图片 (`food_beef_noodle`, `food_fried_noodles` 等)。如果没有，代码中的 `getImageResId` 函数会回退显示默认的 placeholder。
2.  **交互体验**：现在的逻辑是点击 "Add" 后，按钮立即变为 "- 1 +"，用户可以继续点击 "+" 增加数量，或点击 "-" 减少。当数量减为 0 时，控件变回 "Add"。这完全符合您要求的“控制数量”功能。
3.  **数据保存**：点击 "Place Order" 后，订单会被保存到 Room 数据库的 `errands` 表中，您可以在任务列表页面查看到这条 `Food Delivery` 类型的任务。