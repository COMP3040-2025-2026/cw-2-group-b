@startuml Firebase Database Structure
!theme plain
skinparam objectBorderColor #666666

title My Nottingham - Firebase Realtime Database Structure

object "Firebase Realtime Database" as root {
}

package "users/{uid}" {
    object "User Profile" as user {
        username: "student1"
        fullName: "John Doe"
        email: "student1@nottingham.edu.my"
        role: "STUDENT"
        profileImageUrl: "tx1"
        studentId: "20012345"
        faculty: "Computer Science"
        yearOfStudy: "3"
        fcmToken: "..."
    }
}

package "user_conversations/{userId}/{conversationId}" {
    object "Conversation Meta" as userConv {
        participantId: "uid_user2"
        participantName: "Jane Smith"
        participantAvatar: "tx2"
        lastMessage: "Hello!"
        lastMessageTime: 1701234567890
        unreadCount: 2
        isGroup: false
        isPinned: true
    }
}

package "conversations/{conversationId}" {
    object "metadata" as convMeta {
        isGroup: false
        createdAt: 1700000000000
        participants/{uid1}: true
        participants/{uid2}: true
    }

    object "messages/{messageId}" as msg {
        senderId: "uid1"
        senderName: "John Doe"
        message: "Hello!"
        timestamp: 1701234567890
        isRead: false
        messageType: "TEXT"
    }
}

package "forum_posts/{postId}" {
    object "Forum Post" as post {
        authorId: "uid1"
        authorName: "John Doe"
        title: "Study Group"
        content: "Looking for..."
        category: "Academic"
        likes: 5
        views: 23
        commentCount: 3
        timestamp: 1701234567890
    }
}

package "forum_comments/{postId}/{commentId}" {
    object "Comment" as comment {
        authorId: "uid2"
        authorName: "Jane Smith"
        content: "I'm interested!"
        likes: 1
        isPinned: false
        pinnedAt: null
        createdAt: 1701234567890
    }
}

package "enrollments/{courseId}/{studentUid}" {
    object "Enrollment" as enrollment {
        enrolled: true
        enrolledAt: 1700000000000
    }
}

package "sessions/{scheduleId}_{date}" {
    object "Attendance Session" as session {
        isLocked: false
        unlockedBy: "teacher_uid"
        unlockedAt: 1701234567890
        students/{studentUid}/status: "PRESENT"
        students/{studentUid}/signedAt: 1701234567890
    }
}

package "errands/{errandId}" {
    object "Errand" as errand {
        posterId: "uid1"
        posterName: "John Doe"
        title: "Food Delivery"
        description: "..."
        category: "FOOD_DELIVERY"
        reward: 5.00
        status: "OPEN"
        createdAt: 1701234567890
    }
}

package "presence/{userId}" {
    object "Presence" as presence {
        online: true
        lastSeen: 1701234567890
    }
}

root --> user
root --> userConv
root --> convMeta
root --> post
root --> comment
root --> enrollment
root --> session
root --> errand
root --> presence

@enduml
